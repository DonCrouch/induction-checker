<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Agency Induction Checker</title>
<style>
  body{font-family:Segoe UI,system-ui,Arial,sans-serif;margin:0;background:#141446}
  .wrap{max-width:680px;margin:32px auto;padding:24px;background:#fff;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
  h2{text-align:center;color:#00205B}
  label{display:block;margin:12px 0 6px;font-weight:600}
  input,button{width: 90%;
  margin: 10px auto;
  display: block;
  padding: 10px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;}
  input{border:1px solid #ccc}
  button{cursor:pointer;border:0;background:#00205B;color:#fff;margin-top:12px}
  button:hover{background:#0033a0}
  .msg{margin-top:16px;padding:12px;border-radius:6px;display:none}
  .ok{background:#e8f5e9;border:1px solid #2e7d32;color:#1b5e20}
  .warn{background:#fff8e1;border:1px solid #f9a825;color:#8d6e00}
  .err{background:#ffebee;border:1px solid #c62828;color:#b71c1c}
</style>
</head>
<body>
<div class="wrap">
  <h2>Check Your Induction Status</h2>
  <form id="f" autocomplete="on">
    <label for="n">First &amp; Last Name</label>
    <input id="n" required placeholder="e.g. John Smith">
    <label for="s">Your Unique SABRE Reference</label>
    <input id="s" required placeholder="e.g. SAB12345">
    <button id="go" type="submit">Check status</button>
  </form>
  <div id="ok" class="msg ok"></div>
  <div id="warn" class="msg warn"></div>
  <div id="err" class="msg err"></div>
</div>
<script>
document.getElementById('checkBtn').addEventListener('click', async () => {
  const name = document.getElementById('name').value.trim();
  const sabre = document.getElementById('sabre').value.trim();
  const statusDiv = document.getElementById('status');

  if (!name || !sabre) {
    statusDiv.innerHTML = `<div class="error">Please enter both your name and SABRE reference.</div>`;
    return;
  }

  statusDiv.innerHTML = `<div class="loading">Checking status, please wait...</div>`;

  try {
    const res = await fetch("https://defaultaf757c3f7ec14f43954fa0b9a650bd.ff.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/3252a70df28245448294ec944ed25586/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=k4Jv77s-gPqxuDNaNqhThejSvFznEGY2WQYVUIorLRk", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ fullName: name, sabreRef: sabre })
    });

    if (!res.ok) throw new Error(`Server responded ${res.status}`);
    const data = await res.json();

    if (data.result === "valid") {
      statusDiv.innerHTML = `
        <div class="success">
          ✅ Induction already completed on <strong>${data.lastDate}</strong>.<br>
          You don’t need to do it again.
        </div>`;
    } else {
      statusDiv.innerHTML = `
        <div class="warning">
          ⚠️ No valid induction found.<br>
          <a href="https://mdgrp.sharepoint.com/sites/MenziesDistributionAgencyDriverInduction/SitePages/Induction-Modules.aspx?source=FromHomepage#section-1-introducing-menzies-distribution-solutions" target="_blank">
            Click here to start your induction
          </a>
        </div>`;
    }

  } catch (err) {
    console.error(err);
    statusDiv.innerHTML = `
      <div class="error">
        ⚠️ Sorry, something went wrong.<br>
        The system couldn’t connect to the induction database.<br>
        Please try again in a few minutes.
      </div>`;
  }
});
</script>
</body>
</html>



